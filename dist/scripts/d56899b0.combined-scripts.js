!function(){"use strict"}(),function(){window.GAME_ASSETS={images:["earth_bg.jpg"],audio:{menu_music:"through_space.mp3",classic_alien_die:"alien_die.mp3",classic_alien_move0:"alien_move0.mp3",classic_alien_move1:"alien_move1.mp3",classic_alien_shot_hit:"alien_shot_hit.mp3",classic_player_die:"player_die.mp3",classic_player_shoot:"player_shoot.mp3",classic_ship_fly:"ship_fly.mp3",classic_ship_hit:"ship_hit.mp3",frank_die:"boss/frank/FrankDie.mp3",frank_hit1:"boss/frank/FrankHit1.mp3",frank_hit2:"boss/frank/FrankHit2.mp3",frank_laugh:"boss/frank/FrankLaugh.mp3",frank_saying1:"boss/frank/OhMyGod.mp3",frank_saying2:"boss/frank/OhMyGoodLord.mp3"},sprites:{"ui/panel_bg.png":{tile:3185,tileh:3142,map:{panel:[0,0]}},"ui/close_btn.png":{tile:420,tileh:420,map:{close_button_round:[0,0],close_button_round_hover:[1,0],close_button_round_click:[2,0]}},"ui/first_medal.png":{tile:451,tileh:597,map:{medal:[0,0]}},"ui/menu_buttons.png":{tile:340,tileh:60,map:{button:[0,0],button_hover:[0,1],button_click:[0,2]}},"ui/gold_menu_buttons.png":{tile:340,tileh:60,map:{gold_button:[0,0],gold_button_hover:[0,1],gold_button_click:[0,2]}},"ui/start_menu_buttons.png":{tile:340,tileh:60,map:{start_button:[0,0],start_button_hover:[0,1],start_button_click:[0,2]}},"ui/continue_menu_buttons.png":{tile:340,tileh:60,map:{continue_button:[0,0],continue_button_hover:[0,1],continue_button_click:[0,2]}},"ui/classic_menu_buttons.png":{tile:340,tileh:60,map:{classic_button:[0,0],classic_button_hover:[0,1],classic_button_click:[0,2]}},"sprites/alien1.png":{tile:48,tileh:48,map:{classic_alien1:[0,0]}},"sprites/alien2.png":{tile:48,tileh:48,map:{classic_alien2:[0,0]}},"sprites/alien3.png":{tile:48,tileh:48,map:{classic_alien3:[0,0]}},"sprites/alien_explosion.png":{tile:48,tileh:48,map:{classic_alienExplosion:[0,0]}},"sprites/alien_shot.png":{tile:5,tileh:16,map:{classic_alienShot:[0,0]}},"sprites/player_life.png":{tile:25,tileh:23,map:{playerLife:[0,0]}},"sprites/shield.png":{tile:12,tileh:12,map:{classic_shieldSprite:[0,0]}},"sprites/spaceship.png":{tile:80,tileh:30,map:{classic_spaceshipSprite:[0,0]}},"sprites/spaceship_explosion.png":{tile:80,tileh:30,map:{classic_spaceshipExplosion:[0,0]}},"sprites/player_explosion.png":{tile:64,tileh:64,map:{classic_playerExplosion:[0,0]}},"sprites/shell.png":{tile:7,tileh:10,map:{classic_shellSprite:[0,0]}},"sprites/player_cannon.png":{tile:64,tileh:64,map:{classic_cannonSprite:[0,0]}},"sprites/player_base.png":{tile:62,tileh:64,map:{classic_bodySprite:[0,0]}},"ui/score_bar.png":{tile:160,tileh:55,map:{score_bar:[0,0]}},"ui/level_complete_panel.png":{tile:384,tileh:379,map:{level_complete_panel:[0,0]}},"ui/level_complete_score_bg.png":{tile:1886,tileh:425,map:{panel_score:[0,0]}},"ui/level_complete_buttons.png":{tile:100,tileh:102,map:{continue_btn:[0,0],retry_btn:[1,0],back_btn:[2,0]}},"sprites/entities/boss/frank_boss.png":{tile:200,tileh:282,map:{frank:[0,0],frank_shoot:[1,0],frank_happy:[2,0],frank_hit:[3,0],frank_dead:[4,0]}},"sprites/entities/invaders_sheet.png":{tile:25,tileh:22,map:{alien1:[0,0],alien2:[0,1],alien3:[0,2]}},"sprites/entities/power_up_sheet.png":{tile:33,tileh:33,map:{shield_red:[0,0],star_red:[1,0],bolt_red:[2,0],pill_red:[3,0],shield_yellow:[0,1],star_yellow:[1,1],bolt_yellow:[2,1],pill_yellow:[3,1],shield_blue:[0,2],star_blue:[1,2],bolt_blue:[2,2],pill_blue:[3,2],shield_green:[0,3],star_green:[1,3],bolt_green:[2,3],pill_green:[3,3]}},"sprites/entities/player/player_red.png":{tile:99,tileh:75,map:{player_red:[0,0]}},"sprites/entities/player/player_red_left.png":{tile:90,tileh:75,map:{player_red_left:[0,0]}},"sprites/entities/player/player_red_right.png":{tile:90,tileh:75,map:{player_red_left:[0,0]}},"sprites/portraits/professor_charlie_sheet.png":{tile:210,tileh:380,map:{pProfessor:[0,0]}},"sprites/portraits/charlie_sprite.png":{tile:352,tileh:542,map:{pGeneral:[0,0]}},"sprites/portraits/paul_sprite.png":{tile:400,tileh:679,map:{pPilot:[0,0]}}}}}(),function(){Crafty.c("Banner",{init:function(){var a;return a=20,this.mainText=Crafty.e("2D, DOM, Text"),this.subText=Crafty.e("2D, DOM, Text"),this.mainText.unselectable().textColor("#FFFF00").textFont({size:"48px",family:"Silkscreen Expanded"}).css({"text-align":"center"}),this.subText.unselectable().textColor("#FFFF00").textFont({size:"28px",family:"Silkscreen Expanded"}).css({"text-align":"center"}),this.mainText.z=a,this.subText.z=a},show:function(a,b,c,d,e,f){return this.mainText.attr({visible:!0,x:Crafty.viewport.width/2-c/2,y:d,w:c}).text(a),this.subText.attr({visible:!0,x:Crafty.viewport.width/2-e/2,y:f,w:e}).text(b)},hide:function(){return this.mainText.attr({visible:!1}),this.subText.attr({visible:!1})}})}(),function(){this.ClassicAlienConstants=function(){function a(){}return a.IDLE_X=-200,a.IDLE_Y=400,a.WIDTH=a.HEIGHT=48,a.HORIZONTAL_SPEED=10,a.VERTICAL_SPEED=25,a.MOVEMENT_INTERVAL=2e3,a.HITBOX={1:function(){return[8,8,39,8,39,37,8,37]},2:function(){return[8,8,39,8,39,37,8,37]},3:function(){return[8,8,39,8,39,37,8,37]}},a}(),Crafty.c("ClassicAlien",{init:function(){return this.requires("2D, DOM, SpriteAnimation, Collision"),this.direction="w"},respawn:function(){return this.attr({x:this.spawnX,y:this.spawnY,visible:!0}),this.reelPosition(0),this.direction="w",this},die:function(){return Crafty.audio.play("classic_alien_die"),this.dieSilently()},dieSilently:function(){return this.attr({x:ClassicAlienConstants.IDLE_X,y:ClassicAlienConstants.IDLE_Y,visible:!1}),this.node.remove(),this},alien:function(a,b,c){return this.addComponent("classic_alien"+a),this.spawnX=b,this.spawnY=c,this.type=a,this.collision(new Crafty.polygon(ClassicAlienConstants.HITBOX[a]())),this.reel("move",1,0,0,2),this.reel("move"),this},advance:function(){return this.move(this.direction,ClassicAlienConstants.HORIZONTAL_SPEED),this.reelPosition((this.reelPosition()+1)%2),this},descend:function(){return this.move("s",ClassicAlienConstants.VERTICAL_SPEED),"w"===this.direction?this.direction="e":this.direction="w",this},pointsWorth:function(){return 50*this.type},setContainingNode:function(a){return this.node=a,this}})}(),function(){this.ClassicAlienShotConstants=function(){function a(){}return a.SPEED=3,a.WIDTH=5,a.HEIGHT=16,a.MAX_SHOTS=8,a.BASE_SHOT_CHANCE=2,a.ZAP_INTERVAL=200,a.SHOT_IDLE_X=-100,a.SHOT_IDLE_Y=100,a}(),Crafty.c("ClassicAlienShot",{init:function(){return this.requires("2D, DOM, classic_alienShot, Collision, SpriteAnimation"),this.attr({visible:!1}),this.reel("Zap",ClassicAlienShotConstants.ZAP_INTERVAL,0,0,2),this.checkHits("ClassicPlayerBody, ClassicShield"),this.shotHit=function(a){return function(b){var c;return c=b[0].obj,c.has("ClassicShield")&&a.trigger("ShieldHit",c),c.has("ClassicPlayerBody")&&a.trigger("PlayerHit",c),a.stop()}}(this),this.bind("HitOn",this.shotHit),this.containingNode=null,this.containingList=null,this.fired=!1},fireBy:function(a){var b,c;return b=a.x+a.w/2,c=a.y+a.h,this.attr({x:b,y:c,visible:!0}),this.animate("Zap",-1),this.bind("EnterFrame",this.advance),this.containingNode.remove(),this.fired=!0,this},advance:function(){return this.move("s",ClassicAlienShotConstants.SPEED),this.outsidePlayfield()&&this.stop(),this},die:function(){return Crafty.audio.play("classic_alien_shot_hit"),this.stop()},stop:function(){return this.attr({x:ClassicAlienShotConstants.SHOT_IDLE_X,y:ClassicAlienShotConstants.SHOT_IDLE_Y,visible:!1}),this.pauseAnimation(),this.unbind("EnterFrame",this.advance),this.fired===!0&&(this.containingNode=this.containingList.append(this),this.fired=!1),this},outsidePlayfield:function(){return this.y>Crafty.viewport.height},setContainingNode:function(a){return this.containingNode=a},setContainingList:function(a){return this.containingList=a},pointsWorth:function(){return 25}})}(),function(){this.ClassicExplosionConstants=function(){function a(){}return a.IDLE_X=-200,a.IDLE_Y=-300,a}(),Crafty.c("ClassicExplosion",{init:function(){return this.requires("2D, DOM, SpriteAnimation"),this.text=Crafty.e("2D, DOM, Text")},explosion:function(a,b,c,d){return this.addComponent(a),this.reel("Explode",c,0,0,d),this.repeatCount=b,this.bind("AnimationEnd",this.explosionEnded),this.text.unselectable().css({"text-align":"center"}),this.hide(),this},explosionText:function(a,b,c){return this.message=a,this.textSize=c,this.text.textColor(b),this.text.textFont({size:this.textSize+"px",family:"Silkscreen Expanded"}),this},explodeAt:function(a,b){return this.attr({x:a,y:b,visible:!0}),this.animate("Explode",this.repeatCount),this.message&&(this.text.attr({visible:!0,x:this.x,w:this.w,y:Math.floor(this.y+this.h/2-this.textSize/2)}),this.text.text(this.message)),this},explosionEnded:function(){return this.trigger("ExplosionEnded",this),this.hide()},hide:function(){return this.attr({x:ClassicExplosionConstants.IDLE_X,y:ClassicExplosionConstants.IDLE_Y,visible:!1}),this.text.attr({visible:!1}),this}})}(),function(){this.ClassicPlayerConstants=function(){function a(){}return a.WIDTH=a.HEIGHT=64,a.SPEED=200,a.MOVEMENT_ANIMATION_DURATION=250,a.FIRE_ANIMATION_DURATION=300,a.RELOAD_ANIMATION_DURATION=500,a.SHOT_SPEED=8,a.SHOT_IDLE_X=-100,a.SHOT_IDLE_Y=-100,a}(),Crafty.c("ClassicPlayerCommon",{init:function(){return this.tmp=null,this.requires("2D, DOM, Multiway, Collision"),this.multiway(ClassicPlayerConstants.SPEED,{LEFT_ARROW:180,RIGHT_ARROW:0,D:0,A:180}),this.bind("NewDirection",function(a){return this.direction=a}),this.bind("Moved",function(a){var b;return this.hit("Edge")?(b={},b[a.axis]=a.oldValue,this.attr(b)):void 0})},movingOutsidePlayfield:function(a,b){return this.tmp=a+b.x,this.tmp<=0||this.tmp+this.w>=Crafty.viewport.width}}),Crafty.c("ClassicPlayer",{init:function(){return this.requires("Keyboard"),this.body=Crafty.e("ClassicPlayerBody"),this.cannon=Crafty.e("ClassicPlayerCannon"),this.shot=Crafty.e("ClassicPlayerShot"),this.explosion=Crafty.e("ClassicExplosion").explosion("classic_playerExplosion",3,1e3,2),this.isShooting=!1,this.shootingDisabled=!1,this.enableControl(),this.shotHit=function(a){return function(b){var c;return c=b[0].obj,c.has("ClassicAlien")&&a.trigger("AlienHit",c),c.has("ClassicShield")&&a.trigger("ShieldHit",c),c.has("ClassicAlienShot")&&a.trigger("AlienShotHit",c),c.has("ClassicSpaceship")&&a.trigger("SpaceshipHit",[a.shot,c]),a.shot.stop()}}(this),this.playerHit=function(a){return function(b){var c;return c=b[0].obj,c.has("ClassicAlien")?a.trigger("HitByAlien",c):void 0}}(this),this.shot.bind("HitOn",this.shotHit),this.body.bind("HitOn",this.playerHit),this.explosion.bind("ExplosionEnded",function(a){return function(){return a.respawn()}}(this))},setPosition:function(a,b){return this.body.attr({x:a,y:b}),this.cannon.attr({x:a,y:b}),this},x:function(){return this.body.x},y:function(){return this.body.y},show:function(){return this.body.attr({visible:!0}),this.cannon.attr({visible:!0})},hide:function(){return this.body.attr({visible:!1}),this.cannon.attr({visible:!1})},shoot:function(){return this.shot.isActive()||(this.cannon.fire(),this.shot.fireFrom(this.x()+29,this.y()+16),Crafty.audio.play("classic_player_shoot")),this},die:function(){return this.isDead()===!1?(this.explosion.explodeAt(this.body.x,this.body.y),this.disableControl(),this.stopShooting(),this.hide(),Crafty.audio.play("classic_player_die"),!0):!1},isDead:function(){return!this.body._visible},respawn:function(){return this.trigger("Respawning",this)},remove:function(){this.body.destroy(),this.cannon.destroy()},keyDown:function(){return this.isDown(Crafty.keys.SPACE)&&this.shootingDisabled===!1?this.startShooting():void 0},keyUp:function(){return this.isDown(Crafty.keys.SPACE)?void 0:this.stopShooting()},startShooting:function(){return this.isShooting?void 0:(this.isShooting=!0,this.shoot(),this.bind("ShotStopped",this.shoot))},stopShooting:function(){return this.isShooting?(this.isShooting=!1,this.unbind("ShotStopped",this.shoot)):void 0},enableControl:function(){return this.enableShooting(),this.bind("KeyDown",this.keyDown),this.bind("KeyUp",this.keyUp)},disableControl:function(){return this.disableShooting(),this.unbind("KeyDown",this.keyDown),this.unbind("KeyUp",this.keyUp)},disableShooting:function(){return this.shootingDisabled=!0},enableShooting:function(){return this.shootingDisabled=!1}}),Crafty.c("ClassicPlayerBody",{init:function(){return this.requires("ClassicPlayerCommon, classic_bodySprite, SpriteAnimation, Collision"),this.reel("MoveRight",ClassicPlayerConstants.MOVEMENT_ANIMATION_DURATION,0,0,8),this.reel("MoveLeft",ClassicPlayerConstants.MOVEMENT_ANIMATION_DURATION,7,0,-8),this.collision(new Crafty.polygon(12,32,12,64,52,64,52,32)),this.checkHits("ClassicAlien"),this.bind("NewDirection",this.changedDirection),this.currentFrame=0},changedDirection:function(a){switch(a.x){case 0:return this.pauseAnimation(),this.currentFrame=this.getReel();case ClassicPlayerConstants.SPEED:return this.animate("MoveRight",-1),this.reelPosition(this.currentFrame);case-ClassicPlayerConstants.SPEED:return this.animate("MoveLeft",-1),this.reelPosition(this.currentFrame)}}}),Crafty.c("ClassicPlayerCannon",{init:function(){return this.requires("ClassicPlayerCommon, classic_cannonSprite, SpriteAnimation"),this.reel("Fire",ClassicPlayerConstants.FIRE_ANIMATION_DURATION,0,0,7),this.reel("Reload",ClassicPlayerConstants.RELOAD_ANIMATION_DURATION,6,0,-7),this.collision(new Crafty.polygon(12,32,12,64,52,64,52,32)),this.bind("AnimationEnd",this.reload)},fire:function(){return this.animate("Fire")},reload:function(a){return"Fire"===a.id?this.animate("Reload"):void 0}}),Crafty.c("ClassicPlayerShot",{init:function(){return this.requires("2D, DOM, classic_shellSprite, Collision"),this.stop(),this.checkHits("ClassicAlien, ClassicShip, ClassicShield, ClassicAlienShot, ClassicSpaceship")},fireFrom:function(a,b){return this.attr({x:a,y:b,visible:!0}),this.bind("EnterFrame",this.advance),this.active=!0,this},advance:function(){return this.move("n",ClassicPlayerConstants.SHOT_SPEED),this.outsidePlayfield()&&this.stop(),this},stop:function(){return this.attr({x:ClassicPlayerConstants.SHOT_IDLE_X,y:ClassicPlayerConstants.SHOT_IDLE_Y,visible:!1}),this.unbind("EnterFrame",this.advance),this.active=!1,Crafty.trigger("ShotStopped",this),this},isActive:function(){return this.active},outsidePlayfield:function(){return this.y<0}})}(),function(){this.ClassicShieldConstants=function(){function a(){}return a.WIDTH=a.HEIGHT=12,a.IDLE_X=-50,a.IDLE_Y=90,a}(),Crafty.c("ClassicShield",{init:function(){return this.requires("2D, DOM, classic_shieldSprite, SpriteAnimation"),this.reel("Degrade",1,0,0,5),this.reel("Degrade")},shield:function(a,b){return this.spawnX=a,this.spawnY=b,this},degrade:function(){return this.degradation+=1,this.degradation>=this.getReel().frames.length?this.attr({x:ClassicShieldConstants.IDLE_X,y:ClassicShieldConstants.IDLE_Y,visible:!1}):this.reelPosition(this.degradation),this},respawn:function(){return this.degradation=0,this.reelPosition(this.degradation),this.attr({x:this.spawnX,y:this.spawnY,visible:!0}),this}})}(),function(){this.ClassicShipConstants=function(){function a(){}return a.SPEED=4,a.WIDTH=80,a.HEIGHT=30,a.FLIGHT_Y=50,a.SPAWN_CHANCE_INTERVAL=5e3,a.SPAWN_CHANCE=20,a.IDLE_X=-200,a.IDLE_Y=0,a.MOVEMENT_ANIMATION_DURATION=250,a}(),Crafty.c("ClassicSpaceship",{init:function(){return this.requires("2D, DOM, SpriteAnimation, Collision, classic_spaceshipSprite"),this.flying=!1,this.explosion=Crafty.e("ClassicExplosion").explosion("classic_spaceshipExplosion",3,1e3,2),this.attr({x:ClassicShipConstants.IDLE_X,y:ClassicShipConstants.IDLE_Y,visible:!1}),this.reel("MoveRight",ClassicShipConstants.MOVEMENT_ANIMATION_DURATION,0,0,12),this.reel("MoveLeft",ClassicShipConstants.MOVEMENT_ANIMATION_DURATION,11,0,-12)},pointsWorth:function(a){var b,c,d;return d=a._x+a._w/2-this._x,b=Math.abs(this._w/2-d),c=function(){switch(!1){case!(13>b):return 10;case!(26>b):return 7;default:return 4}}(),50*c},destroy:function(a){return this.explosion.explosionText(""+a,"#FFFFFF",10).explodeAt(this.x,this.y),Crafty.audio.play("classic_ship_hit"),this.hide()},hide:function(){return this.attr({x:ClassicShipConstants.IDLE_X,y:ClassicShipConstants.IDLE_Y,visible:!1}),this.pauseAnimation(),this.unbind("EnterFrame",this.advance),Crafty.audio.stop("classic_ship_fly"),this.flying=!1,this},flyTowards:function(a){switch(this.direction=a,this.flying=!0,a){case"w":this.animate("MoveLeft",-1),this.attr({x:Crafty.viewport.width,y:ClassicShipConstants.FLIGHT_Y,visible:!0});break;default:this.animate("MoveRight",-1),this.attr({x:-ClassicShipConstants.WIDTH,y:ClassicShipConstants.FLIGHT_Y,visible:!0})}return this.bind("EnterFrame",this.advance),Crafty.audio.play("classic_ship_fly",-1),this},advance:function(){return this.move(this.direction,ClassicShipConstants.SPEED),this.outsidePlayfield()?this.hide():void 0},outsidePlayfield:function(){return this.x>Crafty.viewport.width||this.x<-ClassicShipConstants.WIDTH},isFlying:function(){return this.flying}})}(),function(){Crafty.c("ClassicWall",{init:function(){return this.requires("2D, Edge, Collision"),this.attr({x:0,y:0,w:2,h:Crafty.viewport.height}),this.wallRight=Crafty.e("2D, Edge, Collision").attr({x:-(Crafty.viewport.x-Crafty.viewport.width)-3,y:0,h:Crafty.viewport.height,w:12}),this.attach(this.wallRight),this}})}(),function(){this.PlayerLifeConstants=function(){function a(){}return a.WIDTH=25,a.HEIGHT=23,a.MARGIN_Y=20,a.MARGIN_X=20,a.MAX_LIVES=10,a.INITIAL_LIVES=3,a}(),Crafty.c("Lives",{init:function(){var a;return this.lives=PlayerLifeConstants.INITIAL_LIVES,this.sprites=function(){var b,c,d;for(d=[],a=b=1,c=PlayerLifeConstants.MAX_LIVES;c>=1?c>=b:b>=c;a=c>=1?++b:--b)d.push(Crafty.e("playerLife, 2D, DOM").attr({x:Crafty.viewport.width-PlayerLifeConstants.MARGIN_X-PlayerLifeConstants.WIDTH*a,y:PlayerLifeConstants.MARGIN_Y,visible:!0}));return d}(),this.updateVisibility()},lifeUp:function(){return this.lives<PlayerLifeConstants.MAX_LIVES&&(this.lives+=1),this.updateVisibility()},lifeDown:function(){return this.lives>0&&(this.lives-=1),this.updateVisibility()},deplete:function(){return this.lives=0,this.updateVisibility()},updateVisibility:function(){var a,b,c,d,e,f,g;if(this.lives>0)for(a=b=0,d=this.lives-1;d>=0?d>=b:b>=d;a=d>=0?++b:--b)this.sprites[a].attr({visible:!0});if(this.lives<PlayerLifeConstants.MAX_LIVES){for(g=[],a=c=e=this.lives,f=PlayerLifeConstants.MAX_LIVES-1;f>=e?f>=c:c>=f;a=f>=e?++c:--c)g.push(this.sprites[a].attr({visible:!1}));return g}},reset:function(){return this.lives=PlayerLifeConstants.INITIAL_LIVES,this.updateVisibility()}})}(),function(){this.ScoreConstants=function(){function a(){}return a.MARGIN_Y=20,a.MARGIN_X=20,a.LIFE_GAIN_SCORE=2500,a}(),Crafty.c("Score",{init:function(){return this.score=0,this.requires("2D, DOM, score_bar, Text"),this.attr({x:ScoreConstants.MARGIN_X,y:ScoreConstants.MARGIN_Y,w:160,h:55}).css({"padding-left":"60px"}),this.updateScore().unselectable().textColor("#FFFF00").textAlign("left").textFont({size:"16px",lineHeight:"55px",family:"KenVector Future"})},reset:function(){return this.score=0,this.updateScore()},addScore:function(a){return Math.floor((this.score+a)/ScoreConstants.LIFE_GAIN_SCORE)>Math.floor(this.score/ScoreConstants.LIFE_GAIN_SCORE)&&this.trigger("LifeIncrement",this),this.score+=a,this.updateScore()},updateScore:function(){return this.text(this.score)},getScore:function(){return this.score}})}(),function(){Crafty.c("MenuButton",{init:function(){return this.requires("2D, DOM, Mouse"),this.attr({w:340,h:60,visible:!1})},create:function(a,b,c,d,e){var f="button";return""!==a&&(f=a+"_"+f),(""===a||"gold"===a)&&(this.addComponent("Text"),this.unselectable().textColor("#FFF").textFont({size:"30px",lineHeight:"60px",family:"KenVector Future"}).textAlign("center"),this.text(e)),this.addComponent(f),this.type=a,this.attr({x:b,y:c,visible:!0}),this.bind("MouseOver",function(){this.sprite(f+"_hover")}),this.bind("MouseOut",function(){this.sprite(f)}),this.bind("MouseDown",function(){this.sprite(f+"_click")}),this.bind("MouseUp",function(){this.sprite(f+"_hover")}),this.bind("Click",d),this}}),Crafty.c("RoundButton",{init:function(){return this.requires("2D, DOM, Mouse"),this},create:function(a,b,c,d){var e="button_round";return""!==a&&(e=a+"_"+e),this.addComponent(e),this.type=a,this.attr({w:60,h:60,x:b,y:c}),this.bind("MouseOver",function(){this.sprite(e+"_hover")}),this.bind("MouseOut",function(){this.sprite(e)}),this.bind("MouseDown",function(){this.sprite(e+"_click")}),this.bind("MouseUp",function(){this.sprite(e+"_hover")}),this.bind("Click",d),this},setParent:function(a){return this.parent=a,this}}),Crafty.c("ClassicMenuPanel",{init:function(){this.requires("2D, DOM, panel"),this.attr({x:Crafty.viewport.width/2-250,y:Crafty.viewport.height/2-246.5,w:500,h:493}),this.elements=[],this.headerText=Crafty.e("2D, DOM, Text").unselectable().textColor("#FFF").textFont({size:"30px",lineHeight:"60px",family:"KenVector Future"}).textAlign("center").text("Classic Mode").attr({x:this.x,y:this.y-8,w:500}),this.elements.push(this.headerText),this.highScoreText=Crafty.e("2D, DOM, Text").unselectable().textColor("#FFF").textFont({size:"22px",family:"KenVector Future"}).text("High Scores").attr({x:this.x+30,y:this.y+80,w:400}),this.elements.push(this.highScoreText),this.loadingText=Crafty.e("2D, DOM, Text").unselectable().textColor("#FFF").textFont({size:"22px",family:"KenVector Future"}).text("Loading").attr({x:this.x+50,y:this.y+130,w:400}),this.elements.push(this.loadingText);var a=this;return $.getJSON("data/classic_high_scores.json",function(b){a.loadingText.destroy(),a.firstText=Crafty.e("2D, DOM, Text").unselectable().textColor("#FFD700").textFont({size:"22px",family:"KenVector Future"}).text("1st").attr({x:a.x+50,y:a.y+130,w:400}),a.elements.push(a.firstText);var c=b.first;a.firstPlayer=Crafty.e("2D, DOM, Text").unselectable().textColor("#FFD700").textFont({size:"22px",family:"KenVector Future"}).text(c.playerName+": "+c.score).attr({x:a.x+75,y:a.y+160,w:400}),a.elements.push(a.firstPlayer),a.firstMedel=Crafty.e("2D, DOM, medal").attr({x:a.x+a.w-70,y:a.y+130,w:50,h:66}),a.elements.push(a.firstMedel),a.secondText=Crafty.e("2D, DOM, Text").unselectable().textColor("#C0C0C0").textFont({size:"22px",family:"KenVector Future"}).text("2nd").attr({x:a.x+50,y:a.y+200,w:400}),a.elements.push(a.secondText);var d=b.second;a.secondPlayer=Crafty.e("2D, DOM, Text").unselectable().textColor("#C0C0C0").textFont({size:"22px",family:"KenVector Future"}).text(d.playerName+": "+d.score).attr({x:a.x+75,y:a.y+230,w:400}),a.elements.push(a.secondPlayer),a.thirdText=Crafty.e("2D, DOM, Text").unselectable().textColor("#cd7f32").textFont({size:"22px",family:"KenVector Future"}).text("3rd").attr({x:a.x+50,y:a.y+270,w:400}),a.elements.push(a.thirdText);var e=b.third;a.thirdPlayer=Crafty.e("2D, DOM, Text").unselectable().textColor("#cd7f32").textFont({size:"22px",family:"KenVector Future"}).text(e.playerName+": "+e.score).attr({x:a.x+75,y:a.y+300,w:400}),a.elements.push(a.thirdPlayer)}),this.playBtn=Crafty.e("MenuButton").create("",this.x+this.w/2-200,this.y+this.h-90,function(){Crafty.audio.stop("classic_music"),Crafty.enterScene("classic")},"Play"),this.elements.push(this.playBtn),this.closeBtn=Crafty.e("RoundButton").setParent(this).create("close",this.x+this.w-100,this.y+this.h-90,function(){Crafty.audio.stop("classic_music"),this.parent.destroy()}),this.elements.push(this.closeBtn),this},remove:function(){_.each(this.elements,function(a){a.destroy()})}})}(),function(){var a;[].slice;a={paused:!1,firstLevel:"Game",togglePause:function(){return this.paused=!this.paused,this.paused?(Crafty("Delay").each(function(){return this.pauseDelays()}),Crafty("Tween").each(function(){return this.pauseTweens()}),Crafty("Particles").each(function(){return this.pauseParticles()}),Crafty("SpriteAnimation").each(function(){return this.pauseAnimation()}),Crafty("PlayerControlledShip").each(function(){return this.disableControls?void 0:(this.disabledThroughPause=!0,this.disableControl())}),Crafty.trigger("GamePause",this.paused)):(Crafty("Delay").each(function(){return this.resumeDelays()}),Crafty("Tween").each(function(){return this.resumeTweens()}),Crafty("Particles").each(function(){return this.resumeParticles()}),Crafty("SpriteAnimation").each(function(){return this.resumeAnimation()}),Crafty("PlayerControlledShip").each(function(){return this.disabledThroughPause?(this.disabledThroughPause=null,this.enableControl()):void 0}),Crafty.trigger("GamePause",this.paused))},start:function(){var b;return this.resetCredits(),b=this.settings(),b.sound===!1&&Crafty.audio.mute(),Crafty.bind("EnterFrame",function(){a.paused}),Crafty.paths({audio:"audio/",images:"images/"}),Crafty.init(800,600),Crafty.background("#000000"),Crafty.enterScene("loading")},resetCredits:function(){return this.credits=2},settings:function(){var a,b;return a=localStorage.getItem("CNFLMYMS"),b={},a&&(b=JSON.parse(a)),_.defaults(b,{sound:!0})},changeSettings:function(a){var b,c;return null==a&&(a={}),b=_.defaults(a,this.settings()),c=JSON.stringify(b),localStorage.setItem("CNFLMYMS",c)}},window.Game=a}(),function(){[].slice;this.Game.say=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(Crafty("Dialog").each(function(){return this.trigger("Abort"),this.destroy()}),m=b.split("\n"),s=60,g=WhenJS.defer(),r=.86*Crafty.viewport.width,h=m.length+1,null!=a&&(h+=1),d=function(){switch(a){case"Professor":return{n:"pProfessor",l:{w:72,h:132}};case"General":return{n:"pGeneral",l:{w:75,h:115}};case"Pilot":return{n:"pPilot",l:{w:71,h:117}}}}(),d&&(h=Math.max(5,h)),f=Crafty.e("2D, UILayerWebGL, Color, Tween, Dialog").attr({w:r,h:20*h,alpha:.7}).color("#000000").attr({x:s-10,y:c.bottom-20*h,z:100}),f.bind("Abort",function(){return g.resolve()}),e=d?100:0,null!=d&&(o=(p=Crafty.e("2D, UILayerWebGL, SpriteAnimation").addComponent(d.n)).attr(_.extend(d.l,{x:f.x+10,y:f.y-20,z:f.z+1})).reel("talk",400,0,0,2).animate("talk",6*m.length),f.attach(o),"none"!==c.noise&&null!==d&&(o.addComponent("Delay"),o.delay(function(){return o.attr({alpha:.6+.3*Math.random()})},159,-1))),n=15,null!=a&&(q=Crafty.e("2D, UILayerDOM, Text").attr({w:r-20,x:f.x+10+e,y:f.y+10,z:101,alpha:1}).text(a).textColor("#707070").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}),f.attach(q),n=30),i=j=0,k=m.length;k>j;i=++j)l=m[i],f.attach(Crafty.e("2D, UILayerDOM, Text").attr({w:r-20,x:f.x+10+e,y:f.y+n+20*i,z:101}).text(l).textColor("#909090").textFont({size:"10px",weight:"bold",family:"Press Start 2P"}));return Crafty.e("Dialog, Delay").delay(function(){return g.resolve(),Crafty("Dialog").each(function(){return this.destroy()})},3e3*m.length,0),g.promise}}(),function(){var a=function(){function a(){}return a.getInRange=function(a,b){return Math.random()*(b-a)+a},a}(),b=function(a,b){return function(){return a.apply(b,arguments)}};this.Classic=function(){function c(){this.playerRespawning=b(this.playerRespawning,this),this.playerAlienCollision=b(this.playerAlienCollision,this),this.playerHit=b(this.playerHit,this),this.alienShotHit=b(this.alienShotHit,this),this.shieldHit=b(this.shieldHit,this),this.spaceshipHit=b(this.spaceshipHit,this),this.alienHit=b(this.alienHit,this),this.update=b(this.update,this),this.initialize()}return c.prototype.initialize=function(){return this.inputSink=Crafty.e("Keyboard"),this.player=this.createPlayer(),this.banner=Crafty.e("Banner"),this.score=Crafty.e("Score"),this.lives=Crafty.e("Lives"),this.spaceship=Crafty.e("ClassicSpaceship"),this.walls=Crafty.e("ClassicWall"),this.createAliens(),this.createAlienShots(),this.createAlienExplosions(),this.createShields(),this.score.bind("LifeIncrement",function(a){return function(){return a.lives.lifeUp()}}(this)),this.inputSink.bind("KeyUp",function(a){return function(b){return b.key===Crafty.keys.ESC?(Crafty.unbind("EnterFrame",a.update),Crafty.enterScene("mainmenu")):void 0}}(this)),Game.say("General","The invaders are coming!",{noise:"low",bottom:450}),this.resetBoard()},c.prototype.resetBoard=function(){return this.banner.hide(),this.lives.reset(),this.player_won=!1,this.score.reset(),this.resetAliens(),this.resetAlienShots(),this.resetSpaceship(),this.resetPlayer(),this.resetShields()},c.prototype.nextRound=function(){return this.inputSink.unbind("KeyUp"),this.banner.hide(),this.player_won=!1,this.player.enableShooting(),this.resetAliens(),this.resetAlienShots()},c.prototype.resetSpaceship=function(){return this.shipSpawnCounter=0,this.spaceship.hide()},c.prototype.createAliens=function(){var a,b,c,d,e,f,g,h;for(this.alienMoveSoundIndex=0,this.alienPool=[],this.aliens=new DLL.DoublyLinkedList,f=Crafty.viewport.width/2-5.5*ClassicAlienConstants.WIDTH,h=100,b=0,c=d=0;11>d;c=++d)for(g=e=0;5>e;g=++e)a=Crafty.e("ClassicAlien").alien(3-Math.floor((g+1)/2),f+ClassicAlienConstants.WIDTH*c,h+ClassicAlienConstants.HEIGHT*g,b++),this.alienPool.push(a);return this.alienCount=this.alienPool.length},c.prototype.resetAliens=function(){var a,b,c,d,e;for(this.alienMoveCounter=0,this.aliens=new DLL.DoublyLinkedList,e=this.alienPool,b=0,c=e.length;c>b;b++)a=e[b],d=this.aliens.append(a),a.respawn().setContainingNode(d);return this.updateAlienMoveInterval()},c.prototype.updateAlienMoveInterval=function(){return this.alienMoveInterval=ClassicAlienConstants.MOVEMENT_INTERVAL/Math.pow(80,1-this.aliens.size()/this.alienCount)},c.prototype.createAlienShots=function(){var a,b,c,d,e,f;for(this.alienShotPool=[],this.alienShots=new DLL.DoublyLinkedList,f=[],a=d=0,e=ClassicAlienShotConstants.MAX_SHOTS-1;e>=0?e>=d:d>=e;a=e>=0?++d:--d)b=Crafty.e("ClassicAlienShot"),b.bind("ShieldHit",this.shieldHit),b.bind("PlayerHit",this.playerHit),c=this.alienShots.append(b),b.setContainingNode(c),b.setContainingList(this.alienShots),f.push(this.alienShotPool.push(b));return f},c.prototype.createAlienExplosions=function(){var a,b,c,d,e;for(c=this.alienExplosions=new DLL.DoublyLinkedList,e=[],a=d=0;6>=d;a=++d)b=Crafty.e("ClassicExplosion").explosion("classic_alienExplosion",1,500,2),b.bind("ExplosionEnded",function(){return c.append(this)}),e.push(this.alienExplosions.append(b));return e},c.prototype.resetAlienShots=function(){var a,b,c,d,e;for(d=this.alienShotPool,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.stop());return e},c.prototype.createShields=function(){var a,b;return this.shieldPool=[],b=80,a=Crafty.viewport.width/2,this.createShieldFormation(a-3*b,500),this.createShieldFormation(a-b,500),this.createShieldFormation(a+b,500),this.createShieldFormation(a+3*b,500)},c.prototype.createShieldFormation=function(a,b){var c,d,e,f,g,h,i;for(i=ClassicShieldConstants.WIDTH,d=[[a-.5*i,b-2*i],[a-1.5*i,b-2*i],[a+.5*i,b-2*i],[a-1.5*i,b-i],[a+.5*i,b-i],[a-2.5*i,b-i],[a+1.5*i,b-i],[a-2.5*i,b],[a+1.5*i,b]],g=[],e=0,f=d.length;f>e;e++)c=d[e],h=Crafty.e("ClassicShield"),g.push(this.shieldPool.push(h.shield.apply(h,c)));return g},c.prototype.resetShields=function(){var a,b,c,d,e;for(c=this.shieldPool,d=[],a=0,b=c.length;b>a;a++)e=c[a],d.push(e.respawn());return d},c.prototype.leftmostAlien=function(){return this.aliens.head().data},c.prototype.rightmostAlien=function(){return this.aliens.tail().data},c.prototype.update=function(a){return this.handleAlienMovement(a.dt)&&(this.player.isDead()||this.handleAlienShots()),this.player_won?void 0:this.handleShipSpawning(a.dt)},c.prototype.handleShipSpawning=function(b){if(this.shipSpawnCounter<ClassicShipConstants.SPAWN_CHANCE_INTERVAL){if(!this.spaceship.isFlying())return this.shipSpawnCounter+=b}else if(this.shipSpawnCounter=0,a.getInRange(0,100)<ClassicShipConstants.SPAWN_CHANCE)return this.spaceship.flyTowards(Math.round(Math.random())?"w":"e")},c.prototype.handleAlienMovement=function(a){var b,c;if(this.alienMoveCounter<this.alienMoveInterval)return this.alienMoveCounter+=a,!1;if(this.alienMoveCounter=0,c=this.aliens.head(),!c)return!1;if(this.aliensMovingOutsideScreen())for(;c;)b=c.data,b.descend(),b.y+ClassicAlienConstants.HEIGHT>Crafty.viewport.height&&(b.dieSilently(),this.lives.deplete(),this.player.die()),c=c.next;else for(;c;)c.data.advance(),c=c.next;return this.alienMoveSoundIndex=(this.alienMoveSoundIndex+1)%2,
this.alienMoveSoundId=Crafty.audio.play("classic_alien_move"+this.alienMoveSoundIndex),!0},c.prototype.handleAlienShots=function(){var b,c,d;for(b=this.aliens.head(),c=[];b&&this.alienShots.size()>0;){if(a.getInRange(0,100)<ClassicAlienShotConstants.BASE_SHOT_CHANCE){if(d=this.alienShots.head(),!d)continue;d.data.fireBy(b.data)}c.push(b=b.next)}return c},c.prototype.aliensMovingOutsideScreen=function(){return"w"===this.leftmostAlien().direction&&this.leftmostAlien().x-ClassicAlienConstants.HORIZONTAL_SPEED<0||"e"===this.rightmostAlien().direction&&this.rightmostAlien().x+ClassicAlienConstants.WIDTH+ClassicAlienConstants.HORIZONTAL_SPEED>Crafty.viewport.width},c.prototype.alienHit=function(a){var b,c;return c=a.pointsWorth(),this.score.addScore(c),b=this.alienExplosions.head(),b.remove(),b.data.explosionText(""+c,"#FFFFFF",10).explodeAt(a.x,a.y),a.die(),this.updateAlienMoveInterval(),54===this.aliens.size()&&Game.say("General","OH MY GOD, THEY EVEN MAKE THE NOISE",{noise:"low",bottom:450}),0===this.aliens.size()?this.victory():void 0},c.prototype.spaceshipHit=function(a){var b,c,d;return b=a[0],d=a[1],c=d.pointsWorth(b),this.score.addScore(c),d.destroy(c)},c.prototype.shieldHit=function(a){return a.degrade()},c.prototype.alienShotHit=function(a){return this.score.addScore(a.pointsWorth()),a.die()},c.prototype.playerHit=function(a){return this.player.die()?this.lives.lifeDown():void 0},c.prototype.playerAlienCollision=function(a){return this.player.die()?this.lives.deplete():void 0},c.prototype.createPlayer=function(){var a=Crafty.e("ClassicPlayer");return a.bind("AlienHit",this.alienHit),a.bind("SpaceshipHit",this.spaceshipHit),a.bind("ShieldHit",this.shieldHit),a.bind("AlienShotHit",this.alienShotHit),a.bind("Respawning",this.playerRespawning),a.bind("HitByAlien",this.playerAlienCollision),a.setPosition(Crafty.viewport.width/2-ClassicPlayerConstants.WIDTH/2,Crafty.viewport.height-ClassicPlayerConstants.HEIGHT),a.show(),a.enableControl(),a},c.prototype.resetPlayer=function(){this.player.destroy(),this.player=this.createPlayer()},c.prototype.playerRespawning=function(a){return 0===this.lives.lives?this.gameOver():void this.resetPlayer()},c.prototype.gameOver=function(){return this.player.hide(),this.player.disableControl(),this.banner.show("Game Over","Final score - "+this.score.getScore()+"<br>Press enter to try again",500,200,600,400),this.inputSink.one("KeyUp",function(a){return function(b){return b.key===Crafty.keys.ENTER?a.resetBoard():void 0}}(this))},c.prototype.victory=function(){return this.banner.show("Victory","Well done, but more aliens are inbound!<br>Press enter to persevere",500,200,600,300),this.player.disableShooting(),this.player_won=!0,this.inputSink.bind("KeyUp",function(a){return function(b){return b.key===Crafty.keys.ENTER?a.nextRound():void 0}}(this))},c}()}(),function(){Crafty.scene("classic",function(){Crafty.background("rgb(32, 55, 67)"),Crafty.createLayer("UILayerDOM","DOM",{scaleResponse:0,yResponse:0,xResponse:0,z:40}),Crafty.createLayer("UILayerWebGL","WebGL",{scaleResponse:0,yResponse:0,xResponse:0,z:35});var a=new Classic;Crafty.bind("EnterFrame",a.update)},function(){})}(),function(){Crafty.scene("loading",function(){Crafty.background("#000 url(images/loading_bg.jpg) no-repeat center center"),Crafty.load(window.GAME_ASSETS,function(){Crafty.enterScene("mainmenu")})},function(){})}(),function(){Crafty.scene("mainmenu",function(){Crafty.background("#000 url(images/earth_bg.jpg) no-repeat center center"),Crafty.audio.play("menu_music",-1);var a=(Crafty.e("MenuButton").create("start",Crafty.viewport.width/2-170,Crafty.viewport.height/5*2,function(){Crafty.audio.stop("menu_music")}),["Classic Mode","Old Man Mode","Over 50's Mode"]);Crafty.e("MenuButton").create("gold",Crafty.viewport.width/2-170,Crafty.viewport.height/5*4,function(){Crafty.audio.stop("menu_music"),Crafty.enterScene("classic")},a[Crafty.math.randomInt(0,a.length-1)]).textFont({size:"24px",family:"Silkscreen Expanded"})},function(){})}(),function(){window.Game.start(!1)}();